<!DOCTYPE html>
<html lang="en">

    <style>
      
      .scheme {
        color: rgb(19, 19, 102);
        text-decoration: solid;
        background-color: whitesmoke;
      }
      
      hr.rounded {
        border-top: 20px solid grey;
        border-radius: 20px;
        
      }

      .instr{
        color: rgb(127, 25, 25);
        text-align: left;
        text-decoration: solid;
      }

      .download{
        color: rgb(42, 42, 160);
        text-decoration: underline;
        
        
      }
      



        .p1
        {
            padding-left: 100px;
        }


       
       
    
    </style>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- <div class="container-sm"> -->
    <!-- <div class="background"> -->
       
        <!-- <p>
            
        </p> -->
        <!-- <div>
            <img src="bits.jpeg" 
	        style="object-fit:contain;
            width:450px;
            height:150px;
            padding-left: 100px;
            border: solid 1px #CCC"/>
        </div> -->


        <style>
            /* Add spacing between table columns */
            table {
                border-collapse: separate;
                border-spacing: 100px 0; /* Adjust the first value to control the spacing between columns */
            }
        </style>
        

        <div class="container text-center">
            <div class="row">
              <div class="col">
                <a href="https://universe.bits-pilani.ac.in/Goa/">
                    <img src="bits.jpeg" 
                    style="object-fit:contain;
                    width:400px;
                    height:100px;
                    /* padding-left: 100px; */
                    "
                    />
                </a>
                
              </div>
              <div class="col">
                <img src="bits1.jpeg" 
	        style="object-fit:contain;
            width:400px;
            height:100px;
            /* padding-left: 100px; */
            "/>
              </div>
            </div>
            
          </div>
        
    <!-- </div> -->
    <!-- </div> -->
</head>

<body>
    
      <hr class="rounded">

      <div class="container text-center" >
        <div class="row">
            
          <div class="col" >
            <center>
                <div class="card" style="width: 90%;">
                
                    <div class="card-body">
                    
                        <h5 class="scheme" >Instructions</h5>
                        <!-- <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6> -->
                        <p class="instr">1) This software works in Mozilla Firefox, Google Chrome and Internet Explorer.</p>
                        <p class="instr">2) File should be in Microsoft Excel format with an extension of ".xls" , ".xlsx" or ".csv" </p>
                        <p class="instr">3) Excel File 1st row will not be used for calculations, Do NOT put marks in it. You can have text labels like: IDNo,Student Name,Total Marks.(Refer sample file). </p>
                        <p class="instr">4) Excel File Last column should have only INTEGER values. Decimal, character values, empty cell values are NOT allowed.</p>
                        <p class="instr">5) Please note that this software is just a virtual screen. No data or Histogram is stored anywhere. Ensure that you download the Histogram and verify the grades cut offs, number of students in each grade and grade allotted before you submit.</p>
                        <div class="container">
                            <div class="row">
                              <div class="col">
                                <a href="User_Manual.pdf" download="User_Manual.pdf" class="download">
                                <center>
                                    <h4 style="font-size: 18px;text-align: center">
                                        Download User Manual 
                                    </h4>
                                </center>
                                </a>
                              </div>
                              <div class="col">
                                <a href="Sample_Data_File.xlsx" download="Sample_Data_File.xlsx" class="download"><h4  style="font-size: 18px; text-align: center;">Download Template File</h4></a>
                              </div>
                            </div>
                            
                          </div>
                        
                        
                        
                    </div>
                  </div>
            </center>
            
          </div>
          <div class="col">

            
            <center>
                <div class="card" style="width: 90%;">

                    <div class="card-body">
                        <h5 class="scheme" >Course Details</h5>
                   

                    <form>
                        <div class="row">
                            <div style="padding: 5px;"></div>
                            <div class="col-2" style="padding: 10px;">
                                <label for="inputEmail3" class="col-sm-2 col-form-label" style="font-weight: bold;text-align : left ;color: grey ;text-decoration: double;font-size: 13px;white-space: nowrap ;">Instructor Name  </label>
                            </div>
                            <div class="col-10">
                                <div class="col-sm-9" style="padding-left: 10px;">
                                    <input type="text" class="form-control" id="input1" >
                                </div>
                            </div>
                            <div class="w-500"></div>
    
                            <div class="col-2" style="padding: 10px;">
                                <label for="inputEmail3" class="col-sm-2 col-form-label" style="font-weight: bold;text-align : left ;color: grey ;text-decoration: double;font-size: 13px;white-space: nowrap ;">Course Code  </label>
                            </div>
                            <div class="col-10">
                                <div class="col-sm-9" style="padding-left: 10px;">
                                    <input type="text" class="form-control" id="input2" >
                                </div>
                            </div>
                            <div class="w-500"></div>
    
                            <div class="col-2" style="padding: 10px;">
                                <label for="inputEmail3" class="col-sm-2 col-form-label" style="font-weight: bold;text-align : left ;color: grey ;text-decoration: double;font-size: 13px;white-space: nowrap ;">Course Name   </label>
                            </div>
                            <div class="col-10">
                                <div class="col-sm-9" style="padding-left: 10px;">
                                    <input type="text" class="form-control" id="input3" >
                                </div>
                            </div>
                            <div class="w-500"></div>
    
                            <div class="col-2" style="padding: 10px;">
                                <label for="inputEmail3" class="col-sm-2 col-form-label" style="font-weight: bold;text-align : left ;color: grey ;text-decoration: double;font-size: 13px;white-space: nowrap ;">Course Total  </label>
                            </div>
                            <div class="col-10">
                                <div class="col-sm-9" style="padding-left: 10px;">
                                    <input type="number" class="form-control" id="input4" >
                                </div>
                            </div>
                            <div class="w-500"></div>

                            <div class="col-2" style="padding: 10px;">
                                <label for="inputEmail3" class="col-sm-2 col-form-label" style="font-weight: bold;text-align : left ;color: grey ;text-decoration: double;font-size: 13px;white-space: nowrap ;">Upload File  </label>
                            </div>
                            <div class="col-10">
                                <div class="form-group">
                                   
                                    <input type="file" class="form-control-file" id="fileInput" accept=".xls, .xlsx, .csv">
                                  </div>
                            </div>
                            <div class="w-500"></div>

                            
                            
                            
                          </div>
                    </form>

                    <div class="row">
                        <div class="col">
                            <button type="button" class="btn btn-primary" onclick="readFile()">Read Excel / CSV Data</button>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" id="drawHistogramButton" disabled  onclick="redirectToHistogramPage()">Draw Histogram</button>
                        </div>
                        <div class="w-100"></div>
                        
                      </div>

                    

                    
                   
                
                
                
                
                
                
                </div>

                    
                    

                    
                    
                </div>
            </center>
            
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>

        


        // Function to load stored values from local storage
        // function loadFromLocalStorage() {
        //     document.getElementById('input1').value = localStorage.getItem('input1') || '';
        //     document.getElementById('input2').value = localStorage.getItem('input2') || '';
        //     document.getElementById('input3').value = localStorage.getItem('input3') || '';
        // }

        // // Load stored values when the page loads
        // loadFromLocalStorage();
        
        // // Add an event listener to update local storage when the input fields change
        // document.getElementById('input1').addEventListener('input', updateLocalStorage);
        // document.getElementById('input2').addEventListener('input', updateLocalStorage);
        // document.getElementById('input3').addEventListener('input', updateLocalStorage);





        // function setTextToLocalStorage() {
        //     const input1Value = document.getElementById('input1').value;
            

        //     console.log(input1Value);
        //     // Store the value in local storage
        //     localStorage.setItem('input1', input1Value);
        // }
        

        // // Function to load stored values from local storage
        // function loadFromLocalStorage() {
        //     const storedValue = localStorage.getItem('input1');
        //     if (storedValue) {
        //         document.getElementById('input1').value = storedValue;
        //     }
        // }

        // // Load stored value when the page loads
        // loadFromLocalStorage();

        // document.getElementById('input1').addEventListener('input', setTextToLocalStorage);
    










function readFile() {
            // Get the file input element
            const fileInput = document.getElementById('fileInput');

            // Check if a file is selected
            if (fileInput.files.length === 0) {
                alert('Please select a file.');
                return;
            }

            // Check if specific input fields are not empty
            const input1 = document.getElementById('input1').value.trim();
            const input2 = document.getElementById('input2').value.trim();
            const input3 = document.getElementById('input3').value.trim();
            const input4 = document.getElementById('input4').value.trim();

            if (input1 === '' || input2 === '' || input3 === '' || input4 === '') {
                alert('Please fill in all required input fields.');
                return;
            }

            if (!isValidInteger(input4)) {
                alert('Please enter a valid integer for "Course Total".');
                return;
            }

            // Get the selected file
            const file = fileInput.files[0];

            // Check the file extension
            const fileName = file.name.toLowerCase();
            if (fileName.endsWith('.xls') || fileName.endsWith('.xlsx') || fileName.endsWith('.csv')) {
                // Read and display file data
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = e.target.result;
                    if (fileName.endsWith('.csv')) {
                        // Process CSV data (you can use a CSV parsing library)
                        const lines = data.split('\n');
                        const tableData = lines.map(line => {
                            const columns = line.split(',');
                            return `<tr class="table-row">${columns.map(column => `<td>${column}</td>`).join('')}</tr>`;
                        }).join('');
                        const tableHTML = `<table>${tableData}</table>`;
                        document.getElementById('dataDisplay').innerHTML = tableHTML;

                        // Enable the "Draw Histogram" button
                        document.getElementById('drawHistogramButton').disabled = false;
                    } else {
                        // Process Excel (XLS/XLSX) data using SheetJS
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                        // Generate an HTML table from JSON data
                        const tableData = jsonData.map(row => {
                            return `<tr class="table-row">${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`;
                        }).join('');
                        const tableHTML = `<table>${tableData}</table>`;
                        document.getElementById('dataDisplay').innerHTML = tableHTML;

                        // Enable the "Draw Histogram" button
                        document.getElementById('drawHistogramButton').disabled = false;
                    }
                };
                reader.readAsBinaryString(file);
            } else {
                alert('Invalid file format. Please select an Excel (XLS/XLSX) or CSV file.');
            }
            const courseTotalInput = document.getElementById("input4");
            const courseTotal = parseInt(courseTotalInput.value);
            console.log(courseTotal);

            // Save the course total in local storage
            localStorage.setItem("courseTotal", courseTotal);



            const input1Value = document.getElementById('input1').value;
            

            console.log(input1Value);
            
            localStorage.setItem('input1', input1Value);

            
            
            
            
            
            const input2Value = document.getElementById('input2').value;
            

            console.log(input2Value);
            
            localStorage.setItem('input2', input2Value);

            
            
            
            
            
            const input3Value = document.getElementById('input3').value;
            

            console.log(input3Value);
            
            localStorage.setItem('input3', input3Value);

            
        }

        function isValidInteger(value) {
            return /^\d+$/.test(value);
        }


        const totalMarksArray = [];


        
        function csvJSON(csv) {
            var lines = csv.split('\n');
            var result = [];
            var headers = lines[0].split(',');

            

            for (var i = 1; i < lines.length; i++) {
                var obj = {};
                var currentLine = lines[i].split(',');

                for (var j = 0; j < headers.length; j++) {
                obj[headers[j]] = currentLine[j];
                }

                result.push(obj);
            }

            return JSON.stringify(result);
        }




        function redirectToHistogramPage() {
            // Get the file input element
            const fileInput = document.getElementById('fileInput');

            // Check if a file is selected
            if (fileInput.files.length === 0) {
                alert('Please select a file.');
                return;
            }

            // Get the selected file
            const file = fileInput.files[0];

            // Check the file extension
            const fileName = file.name.toLowerCase();
            if (fileName.endsWith('.xls') || fileName.endsWith('.xlsx') || fileName.endsWith('.csv')) {
                // Read and validate file data
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = e.target.result;
                    let isValidData = true;
                    const totalMarksArray = [];



                    if (file.name.endsWith('.csv')) {
                        Papa.parse(file, {
                            header: true,
                            dynamicTyping: true,
                            complete: function (results) {
                                const csvData = results.data;

                                // Check if all values under the 'Total_Marks' column are integers
                                for (const row of csvData) {
                                    if (!Number.isInteger(row['Total_Marks'])) {
                                        isValidData = false;
                                        break;
                                    } else {
                                        // Store the 'Total_Marks' value in the array
                                        totalMarksArray.push(row['Total_Marks']);
                                    }
                                }

                                // Now totalMarksArray contains the 'Total_Marks' values as an array
                                console.log(totalMarksArray);
                                console.log(typeof totalMarksArray);
                                localStorage.setItem('totalMarksArray', JSON.stringify(totalMarksArray));

                            },
                            error: function (error) {
                                console.error(error.message);
                            },
                        });
                    }else {
                        // Process Excel (XLS/XLSX) data using SheetJS
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                        // Find the index of the 'Total_Marks' column
                        const totalMarksIndex = jsonData[0].indexOf('Total_Marks');

                        // Check if all values under the 'Total_Marks' column are integers
                        let maxval =1;

                        for(;maxval< jsonData.length;maxval++)
                        {
                            if(jsonData[maxval][totalMarksIndex]== undefined)
                            {
                                break;
                            }
                        }

                        console.log(maxval);

                        var err;

                        for (let i = 1; i < maxval; i++) {
                            if (!Number.isInteger(Number(jsonData[i][totalMarksIndex]))) {
                                isValidData = false;
                                err=i;
                                break;
                            } else {
                                // Store the 'Total_Marks' value in the array
                                totalMarksArray.push(Number(jsonData[i][totalMarksIndex]));
                            }
                        }



                        localStorage.setItem('totalMarksArray', JSON.stringify(totalMarksArray));
                    }

                    // Proceed to the histogram page if the data is valid
                    if (isValidData) {
                        // Store the 'totalMarksArray' in localStorage for use on the other page
                        
                        window.location.href = 'histogram.html';
                    } else {
                        alert('The data in the row ' + err +' of "Total_Marks" column must contain only integers.');
                    }
                };
                reader.readAsBinaryString(file);
            } else {
                alert('Invalid file format. Please select an Excel (XLS/XLSX) or CSV file.');
            }
        }


        const input4Element = document.getElementById('input4');

        
        const input4Value = parseInt(input4Element.value);

        
        // if (!isNaN(input4Value)) {
            
        //     // localStorage.setItem('courseTotal', input4Value);
        //     const courseTotalInput = document.getElementById("input4");
        //     const courseTotal = parseInt(courseTotalInput.value);
        //     console.log(courseTotal);

        //     // Save the course total in local storage
        //     localStorage.setItem("courseTotal", courseTotal);
        // } else {
        //     alert('Course total must be a valid integer.');
        // }


    </script>
        
        


          </div>
        </div>

        <div id="dataDisplay"></div>
        
      </div>

      
</body>

<script href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</html>